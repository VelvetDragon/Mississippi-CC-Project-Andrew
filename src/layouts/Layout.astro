---
export interface Props {
  title?: string;
  pageClass?: string;
}

const { title = 'Mississippi Community Cookbook Project', pageClass = '' } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body class={pageClass}>
    <header class="header">
      <nav class="nav">
        <div class="nav-container">
          <button class="hamburger" id="hamburgerBtn" aria-label="Open menu" aria-controls="mobileDrawer" aria-expanded="false">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </button>
          <ul class="nav-menu" id="navMenu">
            <div class="nav-background" id="navBackground"></div>
            <li><a href="/" data-nav="home" class="home-link">
              <svg class="home-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
              </svg>
            </a></li>
            <li><a href="/cookbooks" data-nav="cookbooks">Cookbooks</a></li>
            <li><a href="/culinary-landscapes" data-nav="landscapes">Culinary Landscapes</a></li>
            <li><a href="/experimental-kitchen" data-nav="kitchen">Experimental Kitchen</a></li>
            <li><a href="/cookery" data-nav="cookery">Cookery</a></li>
            <li><a href="/proof-pudding" data-nav="proof">Proof of the Pudding</a></li>
            <li><a href="/culinary-tales" data-nav="tales">Culinary Tales</a></li>
            <li><a href="/tasted-tested" data-nav="tested">Tasted and Tested</a></li>
          </ul>
        </div>
      </nav>
    </header>

    <div class="mobile-overlay" id="mobileOverlay" hidden></div>
    <aside class="mobile-drawer" id="mobileDrawer" role="dialog" aria-modal="true" aria-label="Main menu" hidden>
      <div class="drawer-header">
        <a href="/" class="drawer-title">Mississippi CC Project</a>
        <button class="drawer-close" id="drawerCloseBtn" aria-label="Close menu">
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </div>
      <nav class="drawer-nav">
        <ul>
          <li><a href="/">Home</a></li>
          <li><a href="/cookbooks">Cookbooks</a></li>
          <li><a href="/culinary-landscapes">Culinary Landscapes</a></li>
          <li><a href="/experimental-kitchen">Experimental Kitchen</a></li>
          <li><a href="/cookery">Cookery</a></li>
          <li><a href="/proof-pudding">Proof of the Pudding</a></li>
          <li><a href="/culinary-tales">Culinary Tales</a></li>
          <li><a href="/tasted-tested">Tasted and Tested</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main">
      <slot />
    </main>

    <footer class="footer">
      <div class="footer-container">
        <div class="footer-content">
          <div class="footer-main">
            <div class="footer-branding">
              <h3 class="footer-title">The Mississippi Community Cookbook Project</h3>
              <!-- <p class="footer-subtitle">A quest to understand the past through the cookbooks Americans created.</p> -->
            </div>
            
            <div class="footer-section">
              <h4 class="footer-heading">Contact</h4>
              <p class="footer-text">
                <a href="mailto:mscommunitycookbook@gmail.com" class="footer-email">mscommunitycookbook@gmail.com</a>
              </p>
            </div>
          </div>
          
          <div class="footer-bottom">
            <div class="footer-credits">
              <p class="copyright">&copy; <span id="currentYear"></span> Mississippi Community Cookbook Project. All rights reserved.</p>
              <p class="research-note">Many of the cookbooks described on this website are available online via the Digital Collections at Southern Miss. Visit <a href="https://www.digitalcollections.usm.edu/mississippiana-and-rare-books" class="footer-link" target="_blank" rel="noopener noreferrer">https://www.digitalcollections.usm.edu/mississippiana-and-rare-books</a></p>
            </div>
            
            <div class="footer-meta">
              <p class="cookbook-description">Illustrations courtesy of <em>Proof of the Pudding</em>, The Shelby Woman's Club. Artwork by Mrs. Sam Long, Mrs. John S. Ferretti, Mrs. David Denton, and Mrs. Gene Coopwood. Cover art courtesy of University Libraries at The University of Southern Mississippi.</p>
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        const navMenu = document.getElementById('navMenu');
        const navBackground = document.getElementById('navBackground');
        const navLinks = navMenu.querySelectorAll('a[data-nav]');
        
        // Normalize paths to avoid trailing-slash or index.html mismatches
        function normalizePath(path) {
          if (!path) return '/';
          try {
            const url = new URL(path, window.location.origin);
            path = url.pathname;
          } catch (_) {}
          path = path.replace(/index\.html$/i, '');
          path = path.replace(/\/+$/, '');
          return path === '' ? '/' : path;
        }

        // Set initial active tab based on current page
        const currentPath = normalizePath(window.location.pathname);
        let activeLink = navMenu.querySelector('a[href="/"]'); // default to home
        
        navLinks.forEach(link => {
          const href = normalizePath(link.getAttribute('href'));
          if (href === currentPath) {
            activeLink = link;
          }
        });

        // Position background on active tab
        function setBackgroundPosition(link) {
          const rect = link.getBoundingClientRect();
          const menuRect = navMenu.getBoundingClientRect();
          
          navBackground.style.left = (rect.left - menuRect.left) + 'px';
          navBackground.style.width = rect.width + 'px';
          navBackground.style.opacity = '1';
        }

        // Set initial position
        if (activeLink) {
          setBackgroundPosition(activeLink);
          activeLink.classList.add('active');
        }

        // Add hover effects
        navLinks.forEach(link => {
          link.addEventListener('mouseenter', () => {
            setBackgroundPosition(link);
          });
          
          link.addEventListener('click', (e) => {
            // Allow navigation but update active state
            navLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            setBackgroundPosition(link);
          });
        });

        // Reset to active tab when mouse leaves
        navMenu.addEventListener('mouseleave', () => {
          const activeTab = navMenu.querySelector('a.active');
          if (activeTab) {
            setBackgroundPosition(activeTab);
          }
        });

        // Reposition on resize for accuracy
        window.addEventListener('resize', () => {
          const activeTab = navMenu.querySelector('a.active');
          if (activeTab) {
            setBackgroundPosition(activeTab);
          }
        });

        // Ensure correct active state on pageshow (browser bfcache)
        window.addEventListener('pageshow', () => {
          const current = normalizePath(window.location.pathname);
          let match = navMenu.querySelector('a[href="/"]');
          navLinks.forEach(link => {
            const href = normalizePath(link.getAttribute('href'));
            if (href === current) {
              match = link;
            }
          });
          navLinks.forEach(l => l.classList.remove('active'));
          if (match) {
            match.classList.add('active');
            setBackgroundPosition(match);
          }
        });

        // Mobile drawer menu logic
        const hamburgerBtn = document.getElementById('hamburgerBtn');
        const mobileDrawer = document.getElementById('mobileDrawer');
        const mobileOverlay = document.getElementById('mobileOverlay');
        const drawerCloseBtn = document.getElementById('drawerCloseBtn');

        function openDrawer() {
          mobileDrawer.removeAttribute('hidden');
          mobileOverlay.removeAttribute('hidden');
          requestAnimationFrame(() => {
            mobileDrawer.classList.add('open');
            mobileOverlay.classList.add('open');
          });
          document.body.style.overflow = 'hidden';
          hamburgerBtn.setAttribute('aria-expanded', 'true');
          // Set active link in drawer
          const current = normalizePath(window.location.pathname);
          mobileDrawer.querySelectorAll('a').forEach(a => {
            const href = normalizePath(a.getAttribute('href'));
            a.classList.toggle('active', href === current);
          });
        }

        function closeDrawer() {
          mobileDrawer.classList.remove('open');
          mobileOverlay.classList.remove('open');
          document.body.style.overflow = '';
          hamburgerBtn.setAttribute('aria-expanded', 'false');
          // Wait for transition then hide
          setTimeout(() => {
            mobileDrawer.setAttribute('hidden', '');
            mobileOverlay.setAttribute('hidden', '');
          }, 250);
        }

        if (hamburgerBtn && mobileDrawer && mobileOverlay) {
          hamburgerBtn.addEventListener('click', openDrawer);
          drawerCloseBtn && drawerCloseBtn.addEventListener('click', closeDrawer);
          mobileOverlay.addEventListener('click', closeDrawer);
          // Close on ESC
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && mobileOverlay.classList.contains('open')) {
              closeDrawer();
            }
          });
          // Close after navigating
          mobileDrawer.querySelectorAll('a').forEach(a => {
            a.addEventListener('click', closeDrawer);
          });
        }
      });
    </script>
  </body>
</html>

<style>
  :root {
    --primary-color: #c8763d;
    --primary-dark: #a85d2a;
    --primary-light: #d4956f;
    --secondary-color: #2c2c2c;
    --text-dark: #1a1a1a;
    --text-light: #ffffff;
    --text-muted: #666666;
    --background: #fafafa;
    --surface: #ffffff;
    --border: #e5e5e5;
    --shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    --shadow-hover: 0 4px 16px rgba(0, 0, 0, 0.12);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Global Modern Background Design (Applied to all pages except homepage) */
  body:not(.homepage) {
    background: 
      radial-gradient(ellipse at top right, rgba(200, 118, 61, 0.015) 0%, transparent 50%),
      linear-gradient(135deg, 
        rgba(200, 118, 61, 0.008) 0%, 
        transparent 30%, 
        transparent 70%, 
        rgba(200, 118, 61, 0.008) 100%
      );
    min-height: 100vh;
  }

  body:not(.homepage)::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
      radial-gradient(circle at 15% 15%, rgba(200, 118, 61, 0.02) 0%, transparent 25%),
      radial-gradient(circle at 85% 85%, rgba(200, 118, 61, 0.015) 0%, transparent 20%),
      linear-gradient(90deg, transparent 49%, rgba(200, 118, 61, 0.003) 50%, transparent 51%);
    background-size: 1000px 1000px, 800px 800px, 200px 200px;
    background-position: 0 0, 500px 300px, 0 0;
    pointer-events: none;
    z-index: -1;
    animation: subtle-drift 25s ease-in-out infinite;
  }

  @keyframes subtle-drift {
    0%, 100% { transform: translateX(0px) translateY(0px); }
    25% { transform: translateX(2px) translateY(-1px); }
    50% { transform: translateX(-1px) translateY(-2px); }
    75% { transform: translateX(-2px) translateY(1px); }
  }

  html {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background-color: var(--background);
    color: var(--text-dark);
    line-height: 1.6;
  }

  /* Consistent link styles across main content */
  .main a,
  .main a:link,
  .main a:visited {
    color: var(--primary-color);
    text-decoration: none;
    border-bottom: 1px solid rgba(200, 118, 61, 0.35);
    transition: color 0.2s ease, border-color 0.2s ease;
  }

  .main a:hover,
  .main a:focus {
    color: var(--primary-dark);
    text-decoration: none;
    border-bottom-color: var(--primary-color);
    outline: none;
  }

  body {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .header {
    background: linear-gradient(
      180deg,
      rgba(255, 255, 255, 0.6) 0%,
      rgba(255, 255, 255, 0.3) 100%
    );
    padding: 1.2rem 0;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(20px) saturate(180%);
    -webkit-backdrop-filter: blur(20px) saturate(180%);
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
  }

  /* Hamburger button */
  .hamburger {
    display: none;
    width: 40px;
    height: 40px;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(16px) saturate(140%);
    -webkit-backdrop-filter: blur(16px) saturate(140%);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    align-items: center;
    justify-content: center;
    gap: 5px;
    flex-direction: column;
  }

  .hamburger .bar {
    display: block;
    width: 20px;
    height: 2px;
    background: var(--text-dark);
    border-radius: 2px;
  }

  /* Drawer and overlay */
  .mobile-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    opacity: 0;
    transition: opacity 200ms ease;
    z-index: 90;
  }

  .mobile-overlay.open {
    opacity: 1;
  }

  .mobile-drawer {
    position: fixed;
    top: 0;
    right: 0;
    height: 100dvh;
    width: min(85vw, 340px);
    background: var(--surface);
    box-shadow: -8px 0 24px rgba(0,0,0,0.12);
    transform: translateX(100%);
    transition: transform 250ms cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 100;
    display: flex;
    flex-direction: column;
  }

  .mobile-drawer.open {
    transform: translateX(0);
  }

  .drawer-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
  }

  .drawer-title {
    font-weight: 700;
    color: var(--text-dark);
    text-decoration: none;
  }

  .drawer-close {
    width: 40px;
    height: 40px;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.9);
    display: grid;
    place-items: center;
    position: relative;
  }

  .drawer-close .bar {
    position: absolute;
    width: 18px;
    height: 2px;
    background: var(--text-dark);
    border-radius: 2px;
  }
  .drawer-close .bar:first-child { transform: rotate(45deg); }
  .drawer-close .bar:last-child { transform: rotate(-45deg); }

  .drawer-nav ul {
    list-style: none;
    padding: 0.75rem 0.5rem;
    display: grid;
    gap: 4px;
  }

  .drawer-nav a {
    display: block;
    padding: 0.875rem 1rem;
    text-decoration: none;
    color: var(--text-dark);
    border-radius: 10px;
  }

  .drawer-nav a:hover,
  .drawer-nav a.active {
    background: rgba(200, 118, 61, 0.08);
    color: var(--primary-dark);
  }

  .nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .nav-menu {
    display: flex;
    list-style: none;
    gap: 0.2rem;
    align-items: center;
    position: relative;
    padding: 0.4rem;
    border-radius: 40px;
    /* iOS 26 Glassy Effect */
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.4) 0%,
      rgba(255, 255, 255, 0.15) 50%,
      rgba(255, 255, 255, 0.25) 100%
    );
    backdrop-filter: blur(24px) saturate(180%);
    -webkit-backdrop-filter: blur(24px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.5);
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 rgba(255, 255, 255, 0.6),
      inset 0 -1px 0 rgba(255, 255, 255, 0.1);
  }

  .nav-background {
    position: absolute;
    top: 0.4rem;
    bottom: 0.4rem;
    background: radial-gradient(120% 120% at 50% 50%, rgba(200, 118, 61, 0.45) 0%, rgba(200, 118, 61, 0.32) 60%, rgba(200, 118, 61, 0.22) 100%);
    border: 1px solid rgba(200, 118, 61, 0.45);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.35), 0 8px 20px rgba(200, 118, 61, 0.25);
    border-radius: 30px;
    transition: left 280ms cubic-bezier(0.4, 0, 0.2, 1), width 280ms cubic-bezier(0.4, 0, 0.2, 1), opacity 200ms ease;
    opacity: 0;
    z-index: -1;
  }

  .nav-menu li {
    position: relative;
    z-index: 1;
  }

  .nav-menu a {
    color: var(--text-dark);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    padding: 0.6rem 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    white-space: nowrap;
    border-radius: 25px;
  }

  .home-link {
    padding: 0.4rem !important;
  }

  .home-icon {
    width: 24px;
    height: 24px;
    color: var(--text-dark);
    transition: all 0.3s ease;
  }

  .home-link:hover .home-icon,
  .home-link.active .home-icon {
    color: var(--primary-dark);
    transform: scale(1.1);
  }

  .nav-menu a:hover,
  .nav-menu a.active {
    color: var(--primary-dark);
    font-weight: 700;
    text-shadow: 0 1px 0 rgba(255,255,255,0.6);
  }

  .main {
    flex: 1;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    width: 100%;
  }

  .footer {
    background: linear-gradient(135deg, var(--secondary-color) 0%, #1a1a1a 100%);
    color: var(--text-light);
    padding: 4rem 0 2rem;
    margin-top: 6rem;
    border-top: 3px solid var(--primary-color);
  }

  .footer-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .footer-content {
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }

  .footer-main {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 3rem;
    align-items: start;
  }

  .footer-branding {
    text-align: left;
  }

  .footer-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary-light);
    margin-bottom: 0.75rem;
    line-height: 1.3;
  }

  .footer-subtitle {
    font-size: 0.95rem;
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.4;
    font-style: italic;
  }

  .footer-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
  }

  .footer-section {
    text-align: left;
  }

  .footer-heading {
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--primary-light);
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .footer-text {
    font-size: 0.85rem;
    line-height: 1.5;
    color: rgba(255, 255, 255, 0.8);
  }

  .footer-text strong {
    color: var(--text-light);
    font-weight: 600;
  }

  .footer-email {
    color: var(--primary-light);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px solid transparent;
    transition: all 0.3s ease;
  }

  .footer-email:hover {
    color: var(--text-light);
    border-bottom-color: var(--primary-light);
  }

  .footer-link {
    color: var(--primary-light);
    text-decoration: none;
    font-weight: 500;
    border-bottom: 1px solid transparent;
    transition: all 0.3s ease;
  }

  .footer-link:hover {
    color: var(--text-light);
    border-bottom-color: var(--primary-light);
  }

  .footer-bottom {
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    padding-top: 2rem;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: start;
  }

  .footer-credits {
    text-align: left;
  }

  .copyright {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    margin-bottom: 0.5rem;
  }

  .research-note {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    font-style: italic;
    line-height: 1.4;
    margin-top: 0.5rem;
  }

  .footer-meta {
    text-align: right;
  }

  .cookbook-description {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.7);
    line-height: 1.5;
    border-left: 2px solid var(--primary-color);
    padding-left: 1rem;
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .nav-menu {
      gap: 0.15rem;
      padding: 0.35rem;
    }
    
    .nav-menu a {
      font-size: 0.85rem;
      padding: 0.55rem 0.9rem;
    }

    .home-icon {
      width: 22px;
      height: 22px;
    }
  }

  @media (max-width: 1024px) {
    .nav-menu {
      gap: 0.1rem;
      padding: 0.3rem;
    }
    
    .nav-menu a {
      font-size: 0.8rem;
      padding: 0.5rem 0.8rem;
    }

    .home-icon {
      width: 20px;
      height: 20px;
    }
  }

  @media (max-width: 768px) {
    .header {
      padding: 1rem 0;
    }

    .nav-container {
      padding: 0 1rem;
      justify-content: space-between;
    }

    .nav-menu { display: none; }
    .hamburger { display: inline-flex; }

    .nav-menu a {
      font-size: 0.75rem;
      padding: 0.45rem 0.7rem;
    }

    .home-icon {
      width: 18px;
      height: 18px;
    }

    .main {
      padding: 0 1rem;
    }

    /* Footer responsive design */
    .footer {
      padding: 3rem 0 1.5rem;
    }

    .footer-container {
      padding: 0 1rem;
    }

    .footer-main {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .footer-branding,
    .footer-section {
      text-align: center;
    }

    .footer-info {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .footer-bottom {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      text-align: center;
    }

    .footer-credits,
    .footer-meta {
      text-align: center;
    }

    .research-note {
      border-left: none;
      border-top: 2px solid var(--primary-color);
      padding-left: 0;
      padding-top: 1rem;
    }

    .footer-title {
      font-size: 1.3rem;
    }
  }

  @media (max-width: 640px) {
    .nav-menu a {
      font-size: 0.7rem;
      padding: 0.4rem 0.6rem;
    }

    /* Extra small screens footer adjustments */
    .footer-title {
      font-size: 1.1rem;
    }

    .footer-subtitle {
      font-size: 0.9rem;
    }

    .footer-heading {
      font-size: 0.85rem;
    }

    .footer-text {
      font-size: 0.8rem;
    }

    .footer-content {
      gap: 2rem;
    }

    .home-icon {
      width: 16px;
      height: 16px;
    }
  }

  @media (max-width: 480px) {
    .nav-menu {
      padding: 0.2rem;
    }
    
    .nav-menu a {
      font-size: 0.65rem;
      padding: 0.35rem 0.5rem;
    }

    .home-icon {
      width: 14px;
      height: 14px;
    }
  }
</style>